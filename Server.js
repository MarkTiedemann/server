new ActiveXObject("WScript.Shell").run("powershell -c \"[System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms'); [System.Reflection.Assembly]::LoadWithPartialName('System.Drawing'); $Url = 'http://localhost:8000/'; $Process = [System.Diagnostics.Process]::New(); $StartInfo = $Process.StartInfo; $StartInfo.FileName = 'powershell'; $StartInfo.Arguments = '-c \"[System.Reflection.Assembly]::LoadWithPartialName(''System.Web''); $Server = [System.Net.HttpListener]::New(); $Server.Prefixes.Add(''http://localhost:8000/''); $Server.Start(); while ($Server.IsListening) { $Context = $Server.GetContext(); $Request = $Context.Request; $Response = $Context.Response; if ($Request.HttpMethod -ne ''GET'') { $Response.StatusCode = 405; $Response.Close(); continue; } try { $Path = ''.'' + $Request.Url.LocalPath -replace ''/'', ''\\''; $File = [System.IO.File]::OpenRead($Path); $Response.ContentType = [System.Web.MimeMapping]::GetMimeMapping($Path); $File.CopyTo($Response.OutputStream); $Response.Close(); $File.Close(); } catch { $Response.StatusCode = 404; $Response.Close(); } }\"'; $StartInfo.UseShellExecute = $false; $StartInfo.CreateNoWindow = $true; $Process.Start(); $IconPath = [System.Environment]::ExpandEnvironmentVariables('%SystemRoot%\\System32\\newdev.exe'); $Icon = [System.Drawing.Icon]::ExtractAssociatedIcon($IconPath); $CurrentUICulture = [System.Globalization.CultureInfo]::CurrentUICulture; $Language = $CurrentUICulture.TwoLetterISOLanguageName; $TrayText = switch ($Language) { 'en' { 'Close server' } 'de' { 'Server beenden' } }; $BalloonTitle = switch ($Language) { 'en' { 'Server listening on ' + $Url } 'de' { 'Server horcht auf ' + $Url } }; $BalloonText = switch ($Language) { 'en' { 'Click here to open. To close, click tray icon.' } 'de' { 'Zum Aufrufen hier klicken. Zum Beenden Ablagebild anklicken.' } }; $NotifyIcon = [System.Windows.Forms.NotifyIcon]::New(); $NotifyIcon.Icon = $Icon; $NotifyIcon.Text = $TrayText; $NotifyIcon.BalloonTipTitle = $BalloonTitle; $NotifyIcon.BalloonTipText = $BalloonText; $NotifyIcon.Visible = $true; $NotifyIcon.Add_Click({ if (!$Process.HasExited) { $Process.Kill(); } $ApplicationContext.ExitThread(); }); $NotifyIcon.Add_BalloonTipClicked({ rundll32.exe url.dll,FileProtocolHandler $Url; }); $NotifyIcon.ShowBalloonTip(0); $ApplicationContext = [System.Windows.Forms.ApplicationContext]::New(); [System.Windows.Forms.Application]::Run($ApplicationContext);\"", 0, false);